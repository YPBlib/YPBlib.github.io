<!DOCTYPE html>
<html lang="zh-cn">
<meta charset="UTF-8">
<head>
  <title>thrift C++源码阅读 TTransport</title>
</head>
<body>


<div><span><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><h1 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 41px; border-bottom: 3px double #999; color: #000; margin-top: 14px;">Apache thrift C++ 源码阅读 TTransport</h1>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">本来想看 Tprotocol 的，cd 进去发现很多实现都依赖于  TTransport 。而 TTransport 里的东西相对独立，没有依赖更早的文件； 更何况http ssl pipe传输什么的相信也有不少学问，那就从 TTransport 开始看吧。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">TTransport.h</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">首先定义了 TTransport 这个类，声明了 isOpen peek open close read read_virt readAll readAll_virt readEnd write write_virt writeEnd flush borrow consume consume_virt getOrigin  等一系列成员函数，即读写相关，其中除了consume borrow write readAll read 和构造函数外全为虚函数。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在每一个非虚函数的定义中都会先通过 T_VIRTUAL_CALL 这个宏调用 VirtualProfiling.cpp 中的 profile_virtual_call 等函数，用于记录非虚函数被调用了多少次。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">虚函数的默认实现大多为抛出异常 &quot;不能在基类上做此操作&quot;</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在 TVirtualTransport.h 中定义了 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">class TTransportDefaults : public TTransport</code>  和<br/>
<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">template &lt;class Transport_, class Super_ = TTransportDefaults&gt; class TVirtualTransport : public Super_</code><br/>
这两个 TTransport 基类，它们提供了虚函数可用的实现，比如 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">static_cast&lt;Transport_*&gt;(this)-&gt;write(buf, len)</code>  ， 使得 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">write_virt</code> 被调用时将 this 指针cast成基类类型，并调用非虚的 write。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">Tsocket</strong>   TCP Socket implementation</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">TSocket</span> :</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> TVirtualTransport&lt;TSocket&gt;
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">这种近似&quot;自己继承自己&quot;的写法和之前 enable_shared_from_this 有点像。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">第一个不那么trivial的成员函数 peek ， 这是一个阻塞调用</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">TSocket::peek</strong></p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bool</span> TSocket::peek() {
  <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> (!isOpen()) {
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">false</span>;
  }
  <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> (interruptListener_) {
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span> (<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> retries = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>;;) {
      <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">THRIFT_POLLFD</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">fds</span>[2];</span>
      <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">std</span>::<span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">memset</span>(fds, <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>, <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">sizeof</span>(fds));
      fds[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>].fd = socket_;
      fds[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>].events = THRIFT_POLLIN;
      fds[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>].fd = *(interruptListener_.get());
      fds[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>].events = THRIFT_POLLIN;
      <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> ret = THRIFT_POLL(fds, <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>, (recvTimeout_ == <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>) ? <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">-1</span> : recvTimeout_);
      <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> errno_copy = THRIFT_GET_SOCKET_ERROR;
      <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> (ret &lt; <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>) {
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// error cases</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> (errno_copy == THRIFT_EINTR &amp;&amp; (retries++ &lt; maxRecvRetries_)) {
          <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">continue</span>;
        }
        GlobalOutput.perror(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;TSocket::peek() THRIFT_POLL() &quot;</span>, errno_copy);
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">throw</span> TTransportException(TTransportException::UNKNOWN, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;Unknown&quot;</span>, errno_copy);
      } <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> (ret &gt; <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>) {
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// Check the interruptListener</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> (fds[<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>].revents &amp; THRIFT_POLLIN) {
          <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">false</span>;
        }
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// There must be data or a disconnection, fall through to the PEEK</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">break</span>;
      } <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> {
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// timeout</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">false</span>;
      }
    }
  }
}
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">interruptListener_ 是 class TSocket 的保护成员，类型为shared_ptr&lt;THRIFT_SOCKET&gt;，用于指示这个 socket 连接上是否有数据可读。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">maxRecvRetries_ 是 TSocket 的类内 int 成员，在 peek 里表示重新尝试读的次数。<br/>
在函数体内部定义了一个 poll 数组，size为2，用于监视 socket_ 和 interruptListener_ 的POLL_IN 活动。 interruptListener_ 的含义目前还不清楚，只在一个 构造函数中被初始化过。  interruptListener_ 在 read函数中发生POLL_IN 事件后会触发中断异常。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">函数 <strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">TSocket::read</strong> 的核心功能是 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">got = static_cast&lt;int&gt;(recv(socket_, cast_sockopt(buf), len, 0));</code>  然后把这个 got 值返回。即读取一定的字节数。但是其长长的函数体中需要考虑多种异常错误处理，典型的如区分 超时异常与资源异常。资源异常的一个触发条件是 未超时，然而 recv 返回的 got &lt; 0, 说明 tcp 连接出现了故障。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">此外 TSocket 有一些属性设置函数如 setLinger，setNoDelay，setKeepAlive . 在Linux 上都是通过 setsockopt 实现的。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">TSSLSocket</strong><br/>
<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">TSSLSocket</code> public 继承自TSocket，很合理。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">thrift 创建了一个 TSSLSocketFactory 函数管理 ssl socket, 代码注释中要求 sslsocket工厂的生命周期应长于任何它所创造的对象，否则工厂销毁时会顺带销毁其创建的SSL 连接，导致一个 socket 可能会调用过期的 openssl。我们也可以打开 manualOpenSSLInitialization_ 开关，自行管理 openssl</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">ssl的几个版本：</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">enum</span> SSLProtocol {
SSLTLS = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>, <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// Supports SSLv2 and SSLv3 handshake but only negotiates at TLSv1_0 or later.</span>
<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//SSLv2 = 1, // HORRIBLY INSECURE!</span>
SSLv3 = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>, <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// Supports SSLv3 only - also horribly insecure!</span>
TLSv1_0 = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">3</span>, <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// Supports TLSv1_0 or later.</span>
TLSv1_1 = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">4</span>, <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// Supports TLSv1_1 or later.</span>
TLSv1_2 = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">5</span>, <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// Supports TLSv1_2 or later.</span>
LATEST = TLSv1_2
};
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">TSSLSocket.h 中定义了几个class列举如下：</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">TSSLSocket</span>;</span>
<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">TSSLSocketFactory</span>;</span>
<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">AccessManager</span>;</span>    <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 用于验证 remote host 的权限，每个TSocket对象中都有一个 AccessManager 成员</span>
<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">DefaultClientAccessManager</span>;</span>
<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">SSLContext</span>;</span>   <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//用于封装一个 OpenSSL 的 SSL_CTX 上下文</span>
<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">TSSLException</span>;</span>
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">THttpTransport</strong><br/>
与http相关的部分还有 THttpServer  THttpClient 等文件。<br/>
client 和 server 各自重写了 parseStatusLine parseHeader 等解析 http 报文的函数。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">TSocketPool</strong></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">Tsocket 的子类。可以在构造函数参数里提供多个ip/port 或者路径用于建立一系列 TCP 连接</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">TNonblockingServerTransport</strong></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">TNonblockingServerSocket</strong><br/>
继承自前者，<br/>
静态常量 DEFAULT_BACKLOG=1024，即允许 tcp 连接队列最长为1024</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">TFDTransport</strong> 文件传输的基类</p>
<hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">TBufferBase</strong><br/>
TBufferedTransport 的基类，用指针维护buffer到达的位置。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">TBufferedTransport</strong></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">注意这里</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">TBufferBase</span> :</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> TVirtualTransport&lt;TBufferBase&gt;

<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">TBufferedTransport</span> :</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> TVirtualTransport&lt;TBufferedTransport, TBufferBase&gt;
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">咋一看可能会感觉 TBufferedTransport 继承了两次 TVirtualTransport。。。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在读写上使用缓冲区：<br/>
实际读的字节数可能多于调用参数里需要的，会把多读的部分放进缓冲区。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在写操作上，数据被写之前是放在一块内存里的。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">TFramedTransport</strong></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">写数据在调用 flush 之前都存在一片内存里。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">TMemoryBuffer</strong></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">纯内存读写，读写用的是用一块buffer</p>
<hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">THeaderTransport</strong></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">又一种内存传输。使用了 compact 传输协议</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">flush() 成员函数的作用？</p>
<hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">TZlibTransport</strong></p>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%0A%23%20Apache%20thrift%20C%2B%2B%20%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%20TProtocol%0A%0A%0A%E6%9C%AC%E6%9D%A5%E6%83%B3%E7%9C%8B%20Tprotocol%20%E7%9A%84%EF%BC%8Ccd%20%E8%BF%9B%E5%8E%BB%E5%8F%91%E7%8E%B0%E5%BE%88%E5%A4%9A%E5%AE%9E%E7%8E%B0%E9%83%BD%E4%BE%9D%E8%B5%96%E4%BA%8E%20%20TTransport%20%E3%80%82%E8%80%8C%20TTransport%20%E9%87%8C%E7%9A%84%E4%B8%9C%E8%A5%BF%E7%9B%B8%E5%AF%B9%E7%8B%AC%E7%AB%8B%EF%BC%8C%E6%B2%A1%E6%9C%89%E4%BE%9D%E8%B5%96%E6%9B%B4%E6%97%A9%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%9B%20%E6%9B%B4%E4%BD%95%E5%86%B5http%20ssl%20pipe%E4%BC%A0%E8%BE%93%E4%BB%80%E4%B9%88%E7%9A%84%E7%9B%B8%E4%BF%A1%E4%B9%9F%E6%9C%89%E4%B8%8D%E5%B0%91%E5%AD%A6%E9%97%AE%EF%BC%8C%E9%82%A3%E5%B0%B1%E4%BB%8E%20TTransport%20%E5%BC%80%E5%A7%8B%E7%9C%8B%E5%90%A7%E3%80%82%0A%0ATTransport.h%0A%0A%E9%A6%96%E5%85%88%E5%AE%9A%E4%B9%89%E4%BA%86%20TTransport%20%E8%BF%99%E4%B8%AA%E7%B1%BB%EF%BC%8C%E5%A3%B0%E6%98%8E%E4%BA%86%20isOpen%20peek%20open%20close%20read%20read_virt%20readAll%20readAll_virt%20readEnd%20write%20write_virt%20writeEnd%20flush%20borrow%20consume%20consume_virt%20getOrigin%20%20%E7%AD%89%E4%B8%80%E7%B3%BB%E5%88%97%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%EF%BC%8C%E5%8D%B3%E8%AF%BB%E5%86%99%E7%9B%B8%E5%85%B3%EF%BC%8C%E5%85%B6%E4%B8%AD%E9%99%A4%E4%BA%86consume%20borrow%20write%20readAll%20read%20%E5%92%8C%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%A4%96%E5%85%A8%E4%B8%BA%E8%99%9A%E5%87%BD%E6%95%B0%E3%80%82%0A%0A%E5%9C%A8%E6%AF%8F%E4%B8%80%E4%B8%AA%E9%9D%9E%E8%99%9A%E5%87%BD%E6%95%B0%E7%9A%84%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%83%BD%E4%BC%9A%E5%85%88%E9%80%9A%E8%BF%87%20T_VIRTUAL_CALL%20%E8%BF%99%E4%B8%AA%E5%AE%8F%E8%B0%83%E7%94%A8%20VirtualProfiling.cpp%20%E4%B8%AD%E7%9A%84%20profile_virtual_call%20%E7%AD%89%E5%87%BD%E6%95%B0%EF%BC%8C%E7%94%A8%E4%BA%8E%E8%AE%B0%E5%BD%95%E9%9D%9E%E8%99%9A%E5%87%BD%E6%95%B0%E8%A2%AB%E8%B0%83%E7%94%A8%E4%BA%86%E5%A4%9A%E5%B0%91%E6%AC%A1%E3%80%82%0A%0A%E8%99%9A%E5%87%BD%E6%95%B0%E7%9A%84%E9%BB%98%E8%AE%A4%E5%AE%9E%E7%8E%B0%E5%A4%A7%E5%A4%9A%E4%B8%BA%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%20%22%E4%B8%8D%E8%83%BD%E5%9C%A8%E5%9F%BA%E7%B1%BB%E4%B8%8A%E5%81%9A%E6%AD%A4%E6%93%8D%E4%BD%9C%22%0A%0A%0A%0A%E5%9C%A8%20TVirtualTransport.h%20%E4%B8%AD%E5%AE%9A%E4%B9%89%E4%BA%86%20%60class%20TTransportDefaults%20%3A%20public%20TTransport%20%60%20%20%E5%92%8C%0A%60template%20%3Cclass%20Transport_%2C%20class%20Super_%20%3D%20TTransportDefaults%3E%0Aclass%20TVirtualTransport%20%3A%20public%20Super_%60%0A%E8%BF%99%E4%B8%A4%E4%B8%AA%20TTransport%20%E5%9F%BA%E7%B1%BB%EF%BC%8C%E5%AE%83%E4%BB%AC%E6%8F%90%E4%BE%9B%E4%BA%86%E8%99%9A%E5%87%BD%E6%95%B0%E5%8F%AF%E7%94%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%8C%E6%AF%94%E5%A6%82%20%60static_cast%3CTransport_*%3E(this)-%3Ewrite(buf%2C%20len)%60%20%20%EF%BC%8C%20%E4%BD%BF%E5%BE%97%20%60write_virt%60%20%E8%A2%AB%E8%B0%83%E7%94%A8%E6%97%B6%E5%B0%86%20this%20%E6%8C%87%E9%92%88cast%E6%88%90%E5%9F%BA%E7%B1%BB%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%B9%B6%E8%B0%83%E7%94%A8%E9%9D%9E%E8%99%9A%E7%9A%84%20write%E3%80%82%0A%0A**Tsocket**%20%20%20TCP%20Socket%20implementation%0A%0A%60%60%60C%2B%2B%0Aclass%20TSocket%20%3A%20public%20TVirtualTransport%3CTSocket%3E%0A%60%60%60%0A%0A%E8%BF%99%E7%A7%8D%E8%BF%91%E4%BC%BC%22%E8%87%AA%E5%B7%B1%E7%BB%A7%E6%89%BF%E8%87%AA%E5%B7%B1%22%E7%9A%84%E5%86%99%E6%B3%95%E5%92%8C%E4%B9%8B%E5%89%8D%20enable_shared_from_this%20%E6%9C%89%E7%82%B9%E5%83%8F%E3%80%82%20%0A%0A%0A%E7%AC%AC%E4%B8%80%E4%B8%AA%E4%B8%8D%E9%82%A3%E4%B9%88trivial%E7%9A%84%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%20peek%20%EF%BC%8C%20%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E9%98%BB%E5%A1%9E%E8%B0%83%E7%94%A8%0A%0A**TSocket%3A%3Apeek**%0A%0A%60%60%60%20C%2B%2B%0Abool%20TSocket%3A%3Apeek()%20%7B%0A%20%20if%20(!isOpen())%20%7B%0A%20%20%20%20return%20false%3B%0A%20%20%7D%0A%20%20if%20(interruptListener_)%20%7B%0A%20%20%20%20for%20(int%20retries%20%3D%200%3B%3B)%20%7B%0A%20%20%20%20%20%20struct%20THRIFT_POLLFD%20fds%5B2%5D%3B%0A%20%20%20%20%20%20std%3A%3Amemset(fds%2C%200%2C%20sizeof(fds))%3B%0A%20%20%20%20%20%20fds%5B0%5D.fd%20%3D%20socket_%3B%0A%20%20%20%20%20%20fds%5B0%5D.events%20%3D%20THRIFT_POLLIN%3B%0A%20%20%20%20%20%20fds%5B1%5D.fd%20%3D%20*(interruptListener_.get())%3B%0A%20%20%20%20%20%20fds%5B1%5D.events%20%3D%20THRIFT_POLLIN%3B%0A%20%20%20%20%20%20int%20ret%20%3D%20THRIFT_POLL(fds%2C%202%2C%20(recvTimeout_%20%3D%3D%200)%20%3F%20-1%20%3A%20recvTimeout_)%3B%0A%20%20%20%20%20%20int%20errno_copy%20%3D%20THRIFT_GET_SOCKET_ERROR%3B%0A%20%20%20%20%20%20if%20(ret%20%3C%200)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20error%20cases%0A%20%20%20%20%20%20%20%20if%20(errno_copy%20%3D%3D%20THRIFT_EINTR%20%26%26%20(retries%2B%2B%20%3C%20maxRecvRetries_))%20%7B%0A%20%20%20%20%20%20%20%20%20%20continue%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20GlobalOutput.perror(%22TSocket%3A%3Apeek()%20THRIFT_POLL()%20%22%2C%20errno_copy)%3B%0A%20%20%20%20%20%20%20%20throw%20TTransportException(TTransportException%3A%3AUNKNOWN%2C%20%22Unknown%22%2C%20errno_copy)%3B%0A%20%20%20%20%20%20%7D%20else%20if%20(ret%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20Check%20the%20interruptListener%0A%20%20%20%20%20%20%20%20if%20(fds%5B1%5D.revents%20%26%20THRIFT_POLLIN)%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20false%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%2F%2F%20There%20must%20be%20data%20or%20a%20disconnection%2C%20fall%20through%20to%20the%20PEEK%0A%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20timeout%0A%20%20%20%20%20%20%20%20return%20false%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0AinterruptListener_%20%E6%98%AF%20class%20TSocket%20%E7%9A%84%E4%BF%9D%E6%8A%A4%E6%88%90%E5%91%98%EF%BC%8C%E7%B1%BB%E5%9E%8B%E4%B8%BAshared_ptr%3CTHRIFT_SOCKET%3E%EF%BC%8C%E7%94%A8%E4%BA%8E%E6%8C%87%E7%A4%BA%E8%BF%99%E4%B8%AA%20socket%20%E8%BF%9E%E6%8E%A5%E4%B8%8A%E6%98%AF%E5%90%A6%E6%9C%89%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%AF%BB%E3%80%82%0A%0A%0A%20%0AmaxRecvRetries_%20%E6%98%AF%20TSocket%20%E7%9A%84%E7%B1%BB%E5%86%85%20int%20%E6%88%90%E5%91%98%EF%BC%8C%E5%9C%A8%20peek%20%E9%87%8C%E8%A1%A8%E7%A4%BA%E9%87%8D%E6%96%B0%E5%B0%9D%E8%AF%95%E8%AF%BB%E7%9A%84%E6%AC%A1%E6%95%B0%E3%80%82%0A%E5%9C%A8%E5%87%BD%E6%95%B0%E4%BD%93%E5%86%85%E9%83%A8%E5%AE%9A%E4%B9%89%E4%BA%86%E4%B8%80%E4%B8%AA%20poll%20%E6%95%B0%E7%BB%84%EF%BC%8Csize%E4%B8%BA2%EF%BC%8C%E7%94%A8%E4%BA%8E%E7%9B%91%E8%A7%86%20socket_%20%E5%92%8C%20interruptListener_%20%E7%9A%84POLL_IN%20%E6%B4%BB%E5%8A%A8%E3%80%82%20interruptListener_%20%E7%9A%84%E5%90%AB%E4%B9%89%E7%9B%AE%E5%89%8D%E8%BF%98%E4%B8%8D%E6%B8%85%E6%A5%9A%EF%BC%8C%E5%8F%AA%E5%9C%A8%E4%B8%80%E4%B8%AA%20%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E4%B8%AD%E8%A2%AB%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%87%E3%80%82%20%20interruptListener_%20%E5%9C%A8%20read%E5%87%BD%E6%95%B0%E4%B8%AD%E5%8F%91%E7%94%9FPOLL_IN%20%E4%BA%8B%E4%BB%B6%E5%90%8E%E4%BC%9A%E8%A7%A6%E5%8F%91%E4%B8%AD%E6%96%AD%E5%BC%82%E5%B8%B8%E3%80%82%0A%0A%E5%87%BD%E6%95%B0%20**TSocket%3A%3Aread**%20%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E6%98%AF%20%60got%20%3D%20static_cast%3Cint%3E(recv(socket_%2C%20cast_sockopt(buf)%2C%20len%2C%200))%3B%60%20%20%E7%84%B6%E5%90%8E%E6%8A%8A%E8%BF%99%E4%B8%AA%20got%20%E5%80%BC%E8%BF%94%E5%9B%9E%E3%80%82%E5%8D%B3%E8%AF%BB%E5%8F%96%E4%B8%80%E5%AE%9A%E7%9A%84%E5%AD%97%E8%8A%82%E6%95%B0%E3%80%82%E4%BD%86%E6%98%AF%E5%85%B6%E9%95%BF%E9%95%BF%E7%9A%84%E5%87%BD%E6%95%B0%E4%BD%93%E4%B8%AD%E9%9C%80%E8%A6%81%E8%80%83%E8%99%91%E5%A4%9A%E7%A7%8D%E5%BC%82%E5%B8%B8%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%EF%BC%8C%E5%85%B8%E5%9E%8B%E7%9A%84%E5%A6%82%E5%8C%BA%E5%88%86%20%E8%B6%85%E6%97%B6%E5%BC%82%E5%B8%B8%E4%B8%8E%E8%B5%84%E6%BA%90%E5%BC%82%E5%B8%B8%E3%80%82%E8%B5%84%E6%BA%90%E5%BC%82%E5%B8%B8%E7%9A%84%E4%B8%80%E4%B8%AA%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6%E6%98%AF%20%E6%9C%AA%E8%B6%85%E6%97%B6%EF%BC%8C%E7%84%B6%E8%80%8C%20recv%20%E8%BF%94%E5%9B%9E%E7%9A%84%20got%20%3C%200%2C%20%E8%AF%B4%E6%98%8E%20tcp%20%E8%BF%9E%E6%8E%A5%E5%87%BA%E7%8E%B0%E4%BA%86%E6%95%85%E9%9A%9C%E3%80%82%0A%0A%E6%AD%A4%E5%A4%96%20TSocket%20%E6%9C%89%E4%B8%80%E4%BA%9B%E5%B1%9E%E6%80%A7%E8%AE%BE%E7%BD%AE%E5%87%BD%E6%95%B0%E5%A6%82%20setLinger%EF%BC%8CsetNoDelay%EF%BC%8CsetKeepAlive%20.%20%E5%9C%A8Linux%20%E4%B8%8A%E9%83%BD%E6%98%AF%E9%80%9A%E8%BF%87%20setsockopt%20%E5%AE%9E%E7%8E%B0%E7%9A%84%E3%80%82%0A%0A%0A**TSSLSocket**%0A%60TSSLSocket%60%20public%20%E7%BB%A7%E6%89%BF%E8%87%AATSocket%EF%BC%8C%E5%BE%88%E5%90%88%E7%90%86%E3%80%82%0A%0Athrift%20%E5%88%9B%E5%BB%BA%E4%BA%86%E4%B8%80%E4%B8%AA%20TSSLSocketFactory%20%E5%87%BD%E6%95%B0%E7%AE%A1%E7%90%86%20ssl%20socket%2C%20%E4%BB%A3%E7%A0%81%E6%B3%A8%E9%87%8A%E4%B8%AD%E8%A6%81%E6%B1%82%20sslsocket%E5%B7%A5%E5%8E%82%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%BA%94%E9%95%BF%E4%BA%8E%E4%BB%BB%E4%BD%95%E5%AE%83%E6%89%80%E5%88%9B%E9%80%A0%E7%9A%84%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%90%A6%E5%88%99%E5%B7%A5%E5%8E%82%E9%94%80%E6%AF%81%E6%97%B6%E4%BC%9A%E9%A1%BA%E5%B8%A6%E9%94%80%E6%AF%81%E5%85%B6%E5%88%9B%E5%BB%BA%E7%9A%84SSL%20%E8%BF%9E%E6%8E%A5%EF%BC%8C%E5%AF%BC%E8%87%B4%E4%B8%80%E4%B8%AA%20socket%20%E5%8F%AF%E8%83%BD%E4%BC%9A%E8%B0%83%E7%94%A8%E8%BF%87%E6%9C%9F%E7%9A%84%20openssl%E3%80%82%E6%88%91%E4%BB%AC%E4%B9%9F%E5%8F%AF%E4%BB%A5%E6%89%93%E5%BC%80%20manualOpenSSLInitialization_%20%E5%BC%80%E5%85%B3%EF%BC%8C%E8%87%AA%E8%A1%8C%E7%AE%A1%E7%90%86%20openssl%20%0A%0Assl%E7%9A%84%E5%87%A0%E4%B8%AA%E7%89%88%E6%9C%AC%EF%BC%9A%0A%0A%60%60%60%20C%2B%2B%0Aenum%20SSLProtocol%20%7B%0ASSLTLS%20%3D%200%2C%20%2F%2F%20Supports%20SSLv2%20and%20SSLv3%20handshake%20but%20only%20negotiates%20at%20TLSv1_0%20or%20later.%0A%2F%2FSSLv2%20%3D%201%2C%20%2F%2F%20HORRIBLY%20INSECURE!%0ASSLv3%20%3D%202%2C%20%2F%2F%20Supports%20SSLv3%20only%20-%20also%20horribly%20insecure!%0ATLSv1_0%20%3D%203%2C%20%2F%2F%20Supports%20TLSv1_0%20or%20later.%0ATLSv1_1%20%3D%204%2C%20%2F%2F%20Supports%20TLSv1_1%20or%20later.%0ATLSv1_2%20%3D%205%2C%20%2F%2F%20Supports%20TLSv1_2%20or%20later.%0ALATEST%20%3D%20TLSv1_2%0A%7D%3B%0A%60%60%60%0A%0ATSSLSocket.h%20%E4%B8%AD%E5%AE%9A%E4%B9%89%E4%BA%86%E5%87%A0%E4%B8%AAclass%E5%88%97%E4%B8%BE%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%0A%60%60%60%20C%2B%2B%0Aclass%20TSSLSocket%3B%0Aclass%20TSSLSocketFactory%3B%0Aclass%20AccessManager%3B%20%20%20%20%2F%2F%20%E7%94%A8%E4%BA%8E%E9%AA%8C%E8%AF%81%20remote%20host%20%E7%9A%84%E6%9D%83%E9%99%90%EF%BC%8C%E6%AF%8F%E4%B8%AATSocket%E5%AF%B9%E8%B1%A1%E4%B8%AD%E9%83%BD%E6%9C%89%E4%B8%80%E4%B8%AA%20AccessManager%20%E6%88%90%E5%91%98%0Aclass%20DefaultClientAccessManager%3B%0Aclass%20SSLContext%3B%20%20%20%2F%2F%E7%94%A8%E4%BA%8E%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%20OpenSSL%20%E7%9A%84%20SSL_CTX%20%E4%B8%8A%E4%B8%8B%E6%96%87%0Aclass%20TSSLException%3B%0A%60%60%60%0A%0A**THttpTransport**%0A%E4%B8%8Ehttp%E7%9B%B8%E5%85%B3%E7%9A%84%E9%83%A8%E5%88%86%E8%BF%98%E6%9C%89%20THttpServer%20%20THttpClient%20%E7%AD%89%E6%96%87%E4%BB%B6%E3%80%82%0Aclient%20%E5%92%8C%20server%20%E5%90%84%E8%87%AA%E9%87%8D%E5%86%99%E4%BA%86%20parseStatusLine%20parseHeader%20%E7%AD%89%E8%A7%A3%E6%9E%90%20http%20%E6%8A%A5%E6%96%87%E7%9A%84%E5%87%BD%E6%95%B0%E3%80%82%0A%0A%0A**TSocketPool**%0A%0ATsocket%20%E7%9A%84%E5%AD%90%E7%B1%BB%E3%80%82%E5%8F%AF%E4%BB%A5%E5%9C%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E9%87%8C%E6%8F%90%E4%BE%9B%E5%A4%9A%E4%B8%AAip%2Fport%20%E6%88%96%E8%80%85%E8%B7%AF%E5%BE%84%E7%94%A8%E4%BA%8E%E5%BB%BA%E7%AB%8B%E4%B8%80%E7%B3%BB%E5%88%97%20TCP%20%E8%BF%9E%E6%8E%A5%0A%0A**TNonblockingServerTransport**%0A%0A**TNonblockingServerSocket**%0A%E7%BB%A7%E6%89%BF%E8%87%AA%E5%89%8D%E8%80%85%EF%BC%8C%0A%E9%9D%99%E6%80%81%E5%B8%B8%E9%87%8F%20DEFAULT_BACKLOG%3D1024%EF%BC%8C%E5%8D%B3%E5%85%81%E8%AE%B8%20tcp%20%E8%BF%9E%E6%8E%A5%E9%98%9F%E5%88%97%E6%9C%80%E9%95%BF%E4%B8%BA1024%0A%0A**TFDTransport**%20%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E7%9A%84%E5%9F%BA%E7%B1%BB%0A%0A%0A*%20*%20*%0A%0A%0A**TBufferBase**%0ATBufferedTransport%20%E7%9A%84%E5%9F%BA%E7%B1%BB%EF%BC%8C%E7%94%A8%E6%8C%87%E9%92%88%E7%BB%B4%E6%8A%A4buffer%E5%88%B0%E8%BE%BE%E7%9A%84%E4%BD%8D%E7%BD%AE%E3%80%82%0A%0A**TBufferedTransport**%0A%0A%E6%B3%A8%E6%84%8F%E8%BF%99%E9%87%8C%0A%60%60%60%20C%2B%2B%0Aclass%20TBufferBase%20%3A%20public%20TVirtualTransport%3CTBufferBase%3E%0A%0Aclass%20TBufferedTransport%20%3A%20public%20TVirtualTransport%3CTBufferedTransport%2C%20TBufferBase%3E%0A%60%60%60%0A%E5%92%8B%E4%B8%80%E7%9C%8B%E5%8F%AF%E8%83%BD%E4%BC%9A%E6%84%9F%E8%A7%89%20TBufferedTransport%20%E7%BB%A7%E6%89%BF%E4%BA%86%E4%B8%A4%E6%AC%A1%20TVirtualTransport%E3%80%82%E3%80%82%E3%80%82%0A%0A%E5%9C%A8%E8%AF%BB%E5%86%99%E4%B8%8A%E4%BD%BF%E7%94%A8%E7%BC%93%E5%86%B2%E5%8C%BA%EF%BC%9A%0A%E5%AE%9E%E9%99%85%E8%AF%BB%E7%9A%84%E5%AD%97%E8%8A%82%E6%95%B0%E5%8F%AF%E8%83%BD%E5%A4%9A%E4%BA%8E%E8%B0%83%E7%94%A8%E5%8F%82%E6%95%B0%E9%87%8C%E9%9C%80%E8%A6%81%E7%9A%84%EF%BC%8C%E4%BC%9A%E6%8A%8A%E5%A4%9A%E8%AF%BB%E7%9A%84%E9%83%A8%E5%88%86%E6%94%BE%E8%BF%9B%E7%BC%93%E5%86%B2%E5%8C%BA%E3%80%82%0A%0A%0A%E5%9C%A8%E5%86%99%E6%93%8D%E4%BD%9C%E4%B8%8A%EF%BC%8C%E6%95%B0%E6%8D%AE%E8%A2%AB%E5%86%99%E4%B9%8B%E5%89%8D%E6%98%AF%E6%94%BE%E5%9C%A8%E4%B8%80%E5%9D%97%E5%86%85%E5%AD%98%E9%87%8C%E7%9A%84%E3%80%82%0A%0A%0A**TFramedTransport**%0A%0A%E5%86%99%E6%95%B0%E6%8D%AE%E5%9C%A8%E8%B0%83%E7%94%A8%20flush%20%E4%B9%8B%E5%89%8D%E9%83%BD%E5%AD%98%E5%9C%A8%E4%B8%80%E7%89%87%E5%86%85%E5%AD%98%E9%87%8C%E3%80%82%0A%0A**TMemoryBuffer**%0A%0A%E7%BA%AF%E5%86%85%E5%AD%98%E8%AF%BB%E5%86%99%EF%BC%8C%E8%AF%BB%E5%86%99%E7%94%A8%E7%9A%84%E6%98%AF%E7%94%A8%E4%B8%80%E5%9D%97buffer%0A%0A%0A*%20*%20*%0A%0A%0A**THeaderTransport**%0A%0A%E5%8F%88%E4%B8%80%E7%A7%8D%E5%86%85%E5%AD%98%E4%BC%A0%E8%BE%93%E3%80%82%E4%BD%BF%E7%94%A8%E4%BA%86%20compact%20%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE%0A%0Aflush()%20%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%9C%E7%94%A8%EF%BC%9F%0A%0A%0A*%20*%20*%0A%0A**TZlibTransport**%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%20%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A%0A</center></span>
</div></body></html>