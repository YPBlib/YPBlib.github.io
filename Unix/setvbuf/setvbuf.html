<!DOCTYPE html>
  <html lang="zh-cn">
    <meta charset="UTF-8">
    <head>
        <title>IO缓冲</title>
    </head>
<body>


<div>
<span><div><div><br/></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#include &lt;stdio.h&gt;</div><div>#include &lt;stdlib.h&gt;</div><div>#include &lt;string.h&gt;</div><div>#include &lt;unistd.h&gt;</div><div><br/></div><div>int main()</div><div>{</div><div>/*</div><div>  for(int ct=0;ct&lt;10;++ct)</div><div>{</div><div>  char buf[20]={0};</div><div>  read(0,buf,10*sizeof(char));</div><div>  for(int i=0;i&lt;20;++i)</div><div>  printf(&quot;%d &quot;,(int)buf[i]);</div><div>  printf(&quot;\n&quot;);</div><div>}</div><div>*/</div><div>  char buf[4110]={0};</div><div>  read(0,buf,4120*sizeof(char));</div><div>  for(int i=0;i&lt;15;++i)</div><div>  printf(&quot;%x &quot;,(int)buf[i]);</div><div>  printf(&quot;\n&quot;);</div><div>  for(int i=4094;i&lt;4110;++i)</div><div>  printf(&quot;%x &quot;,(int)buf[i]);</div><div>  printf(&quot;\n&quot;);</div><div><br/></div><div>  memset(buf,0,4110*sizeof(char));</div><div>  read(0,buf,4099*sizeof(char));</div><div>  for(int i=0;i&lt;15;++i)</div><div>  printf(&quot;%x &quot;,(int)buf[i]);</div><div>  printf(&quot;\n&quot;);</div><div>  for(int i=4094;i&lt;4110;++i)</div><div>  printf(&quot;%x &quot;,(int)buf[i]);</div><div>  printf(&quot;\n&quot;);</div><div>  return 0;</div><div><br/></div><div>}</div></div><div><br/></div><div><br/></div><div>参考链接</div><div><br/></div><div><a href="https://stackoverflow.com/questions/28311201/buffer-size-in-file-i-o">https://stackoverflow.com/questions/28311201/buffer-size-in-file-i-o</a></div><div><br/></div><div><a href="https://linux.die.net/man/3/read">https://linux.die.net/man/3/read</a></div><div><br/></div><div><a href="https://stackoverflow.com/questions/13729710/how-to-handle-the-input-buffer-in-c">https://stackoverflow.com/questions/13729710/how-to-handle-the-input-buffer-in-c</a></div><div><br/></div><div><a href="http://www.learntosolveit.com/cprogramming/sec_8.2_getchar.html">http://www.learntosolveit.com/cprogramming/sec_8.2_getchar.html</a></div><div><br/></div><div><a href="http://www.pixelbeat.org/programming/stdio_buffering/">http://www.pixelbeat.org/programming/stdio_buffering/</a></div><div><br/></div><div><a href="https://stackoverflow.com/questions/13833628/how-to-increase-the-stdin-buffersize">https://stackoverflow.com/questions/13833628/how-to-increase-the-stdin-buffersize</a></div><div><br/></div><div><a href="https://stackoverflow.com/questions/5876373/using-setvbuf-with-stdin-stream">https://stackoverflow.com/questions/5876373/using-setvbuf-with-stdin-stream</a></div><div><br/></div><div><a href="http://mirror.fsf.org/pmon2000/3.x/src/lib/libc/fgets.c">http://mirror.fsf.org/pmon2000/3.x/src/lib/libc/fgets.c</a></div><div><br/></div><div><a href="https://stackoverflow.com/questions/16397832/fgets-implementation-kr">https://stackoverflow.com/questions/16397832/fgets-implementation-kr</a></div><div><br/></div><div><a href="https://stackoverflow.com/questions/10904067/in-c-whats-the-size-of-stdout-buffer">https://stackoverflow.com/questions/10904067/in-c-whats-the-size-of-stdout-buffer</a></div><div><br/></div><div><a href="http://man7.org/linux/man-pages/man3/setbuf.3.html">http://man7.org/linux/man-pages/man3/setbuf.3.html</a></div><div><br/></div><div><a href="https://linux.die.net/man/3/setbuf">https://linux.die.net/man/3/setbuf</a></div><div><br/></div><div><br/></div><hr/><div><br/></div><div><br/></div><div>c++ 版本</div><div><br/></div><div><br/></div><div>以下代码默认行为是子线程被主线程阻塞，只有输入数字后子线程才有输出</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><br/></div><div>#include &lt;iostream&gt;</div><div>#include &lt;thread&gt;</div><div>#include &lt;chrono&gt;</div><div><br/></div><div>using namespace std;</div><div>int main( )</div><div>{</div><div>thread([]{</div><div>while(1){</div><div>this_thread::sleep_for(chrono::seconds(1));</div><div>printf( &quot; 1&quot; );</div><div>}</div><div>}).detach();</div><div>while(1){</div><div>printf(&quot;2&quot;);</div><div>int a;</div><div>cin &gt;&gt; a;</div><div>printf(&quot;%d&quot;, a);</div><div>}</div><div>return 0;</div><div>}</div></div><div><br/></div><div><br/></div><div>解决办法1， 给子线程加 \n</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><br/></div><div>#include &lt;iostream&gt;</div><div>#include &lt;thread&gt;</div><div>#include &lt;chrono&gt;</div><div><br/></div><div>using namespace std;</div><div>int main( )</div><div>{</div><div>thread([]{</div><div>while(1){</div><div>this_thread::sleep_for(chrono::seconds(1));</div><div>printf( &quot; 1\n&quot; );</div><div>}</div><div>}).detach();</div><div>while(1){</div><div>printf(&quot;2&quot;);</div><div>int a;</div><div>cin &gt;&gt; a;</div><div>printf(&quot;%d&quot;, a);</div><div>}</div><div>return 0;</div><div>}</div></div><div><br/></div><div><br/></div><div>或者使用 setvbuf  改变缓冲设置</div><div><br/></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><br/></div><div>#include &lt;iostream&gt;</div><div>#include &lt;thread&gt;</div><div>#include &lt;chrono&gt;</div><div>#include &lt;unistd.h&gt;</div><div>using namespace std;</div><div>int main( )</div><div>{</div><div>setvbuf(stdout, NULL, _IONBF, 0);</div><div>setvbuf(stdin, NULL, _IONBF, 0);</div><div>thread([]{</div><div>while(1){</div><div>this_thread::sleep_for(chrono::seconds(1));</div><div>printf( &quot; 1&quot; );</div><div>}</div><div>}).detach();</div><div>while(1){</div><div>printf(&quot;2&quot;);</div><div>int a;</div><div>cin &gt;&gt; a;</div><div>printf(&quot;%d&quot;, a);</div><div>}</div><div>return 0;</div><div>}</div></div><div><br/></div><div><br/></div><div><br/></div><div>都可以解决线程被阻塞的问题。</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div></span>
</div>
</body>
</html>